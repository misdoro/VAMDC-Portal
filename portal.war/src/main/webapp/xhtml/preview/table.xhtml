<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">



	<rich:panel styleClass="resultTable">
		<f:facet name="header">
			<!-- titlePrefix defined in file including this one  -->
			<h:outputText value="Results by node" />
		</f:facet>

		<rich:dataTable id="previewTable" value="#{preview.nodes}" var="node"
			onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
			onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
			columnClasses=",alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter,alignCenter">
			<f:facet name="header">
				<rich:columnGroup>
					<h:column>
						<h:outputText styleClass="headerText" value="Name" />
					</h:column>
					<h:column>

						<h:outputText value="View data" styleClass="headerText" />
						<h:outputText value=" ( Please wait until query is complete )"
							rendered="#{!preview.done }" />


					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Response" />
					</h:column>
					<h:column>
						<h:outputLink styleClass="headerText" target="_blank"
							value="https://github.com/VAMDC/Standards/blob/master/doc/source/dataAccessProtocol/vamdctap.rst#data-modifcation-time">
                        Last database update
                        </h:outputLink>
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Download" />
					</h:column>

					<h:column>
						<h:outputText styleClass="headerText" value="Species" />
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="States" />
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Processes" />
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Radiative" />
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Collisions" />
					</h:column>
					<h:column>
						<h:outputText styleClass="headerText" value="Non Radiative" />
					</h:column>

				</rich:columnGroup>
			</f:facet>

			<h:column>
				<h:outputText
					value="#{registryFacade.getResourceTitle(node.ivoaID)}" />
			</h:column>
			<h:column>
				<h:selectOneMenu id="somp#{node.recordID}"
					disabled="#{!preview.done }" rendered="#{node.isOk()}">
					<f:selectItem itemValue="-- Choose display --" />
					<f:selectItems value="#{consumers.nodeConsumers[node.ivoaID]}" />
					<a4j:support id="ajaxsomp#{node.recordID}" event="onchange"
						action="#{consumers.process(node.fullQueryURL)}"
						actionListener="#{consumers.changeConsumerSelected}"
						reRender="consumerupdate#{node.recordID}"></a4j:support>
				</h:selectOneMenu>
				<h:panelGroup id="consumerupdate#{node.recordID}" layout="block">
					<a4j:region>
						<a4j:poll id="consumerPoll" interval="1000"
							enabled="#{consumers.processing}" reRender="consumerupdate" />
					</a4j:region>
					<a4j:outputPanel rendered="#{consumers.ok}">
						<script>
							window.open("#{consumers.location}");
						</script>
					</a4j:outputPanel>
					<h:graphicImage value="/img/waitingIcon.gif" width="16" height="16"
						rendered="#{consumers.processing}" />
					<h:graphicImage value="/img/error.gif" id="consumerErrorImg"
						rendered="#{consumers.errorHappened}">
						<rich:toolTip value="#{consumers.error}" styleClass="toolTip"
							direction="top-left" id="consumerErrorText" />
					</h:graphicImage>
					<h:outputLink value="#{consumers.location}" target="_blank"
						rendered="#{consumers.ok}" tabindex="30">
						<h:outputText value="Display" />
					</h:outputLink>
				</h:panelGroup>

			</h:column>

			<h:column>
				<h:outputText value="#{node.status}" id="st#{node.recordID}">
					<rich:toolTip value="#{node.statusDescription}"
						styleClass="toolTip" direction="bottom-right" />
				</h:outputText>

				<h:outputText value=" (#{node.truncated}% of data returned)"
					rendered="#{node.status=='TRUNCATED'}" />

			</h:column>

			<h:column>
				<h:outputText value="#{node.modifyDate}"
					rendered="#{node.lastModSet}">
					<s:convertDateTime type="both" pattern=" dd/MM/yyyy HH:mm " />
				</h:outputText>
				<h:outputText value="Not available" rendered="#{!node.lastModSet}" />
			</h:column>

			<h:column>
				<h:outputLink value="#{node.fullQueryURL}" target="_blank"
					rendered="#{node.isOk()}">
					<h:outputText value="XSAMS" />
				</h:outputLink>
			</h:column>

			<h:column>
				<h:outputText value="#{node.species}" />
			</h:column>
			<h:column>
				<h:outputText value="#{node.states}" />
			</h:column>
			<h:column>
				<h:outputText value="#{node.processes}" />
			</h:column>
			<h:column>
				<h:outputText value="#{node.radiative}" />
			</h:column>
			<h:column>
				<h:outputText value="#{node.collisions}" />
			</h:column>
			<h:column>
				<h:outputText value="#{node.nonRadiative}" />
			</h:column>

		</rich:dataTable>
	</rich:panel>

</ui:composition>
